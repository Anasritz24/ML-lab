<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>WhisperRead — Static Export</title>
    <meta name="description" content="WhisperRead static HTML/CSS/JS export" />
    <link rel="canonical" href="https://whisperread.com/" />
    <meta property="og:url" content="https://whisperread.com/" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-gradient-to-b from-white to-sky-50 dark:from-slate-900 dark:to-slate-800 min-h-screen text-slate-900 dark:text-slate-100"
  >
    <header class="max-w-5xl mx-auto p-6 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <img
          src="assets/whisperread-logo.svg"
          alt="WhisperRead"
          class="h-12 w-auto"
        />
        <div>
          <h1 class="text-2xl font-extrabold">WhisperRead</h1>
          <p class="text-sm text-slate-500 dark:text-slate-400">
            Upload PDFs and have them read aloud — static demo
          </p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button
          id="openShare"
          class="inline-flex items-center gap-2 rounded-md px-3 py-2 bg-white/90 dark:bg-slate-700/60 border shadow-sm"
        >
          Share
        </button>
        <a
          href="reader.html"
          class="inline-flex items-center gap-2 rounded-md px-3 py-2 bg-sky-600 text-white"
          >Open Reader</a
        >
      </div>
    </header>

    <main class="max-w-5xl mx-auto p-6">
      <section class="bg-white/80 dark:bg-slate-900/60 rounded-2xl p-6 shadow">
        <h2 class="text-lg font-semibold mb-2">Welcome</h2>
        <p class="text-sm text-slate-600 dark:text-slate-300">
          This is a static HTML/CSS/JS export of WhisperRead. Use the Reader to
          upload and view PDFs in your browser. Use Share to copy a link or
          display a QR code others can scan.
        </p>
        <div class="mt-6 flex gap-3">
          <button
            id="openShare2"
            class="px-4 py-2 rounded bg-sky-500 text-white"
          >
            Share this page
          </button>
        </div>
      </section>
    </main>

    <!-- Share modal -->
    <div
      id="shareModal"
      class="fixed inset-0 hidden items-center justify-center bg-black/40"
    >
      <div class="bg-white dark:bg-slate-800 rounded-xl p-6 w-full max-w-lg">
        <h3 class="text-lg font-semibold">Share this website</h3>
        <p class="text-sm text-slate-500 dark:text-slate-400">
          Copy the link or show a QR code people can scan.
        </p>
        <div class="mt-4 flex gap-2">
          <input
            id="shareUrl"
            class="flex-1 rounded border px-3 py-2 bg-transparent"
            readonly
          />
          <button id="copyBtn" class="px-3 py-2 rounded bg-slate-100">
            Copy
          </button>
        </div>
        <div class="mt-4 flex items-center gap-2">
          <button id="toggleQR" class="px-3 py-2 rounded bg-sky-500 text-white">
            Show QR
          </button>
          <button id="downloadQR" class="px-3 py-2 rounded border">
            Download QR
          </button>
          <button id="closeShare" class="ml-auto px-3 py-2 rounded">
            Close
          </button>
        </div>
        <div id="qrWrap" class="mt-4 hidden justify-center">
          <img
            id="qrImg"
            alt="QR code"
            class="h-48 w-48 rounded border bg-white p-1"
          />
        </div>
      </div>
    </div>

    <script>
      // Share modal logic
      const openShare = document.getElementById("openShare");
      const openShare2 = document.getElementById("openShare2");
      const modal = document.getElementById("shareModal");
      const shareUrl = document.getElementById("shareUrl");
      const copyBtn = document.getElementById("copyBtn");
      const closeShare = document.getElementById("closeShare");
      const toggleQR = document.getElementById("toggleQR");
      const qrWrap = document.getElementById("qrWrap");
      const qrImg = document.getElementById("qrImg");
      const downloadQR = document.getElementById("downloadQR");

      // Use a canonical site URL for sharing. To actually serve the site under this domain,
      // deploy to a host and configure DNS to point your custom domain (e.g. Netlify/Vercel).
      const BASE_SITE = "https://whisperread.com";

      function currentUrl() {
        // Preserve path when possible, but show the clean custom domain in shared links.
        try {
          const path =
            window.location.pathname +
            window.location.search +
            window.location.hash;
          return BASE_SITE + path;
        } catch (e) {
          return BASE_SITE;
        }
      }

      function qrUrlFor(u) {
        return `https://api.qrserver.com/v1/create-qr-code/?size=512x512&data=${encodeURIComponent(u)}`;
      }

      function showModal() {
        shareUrl.value = currentUrl();
        qrImg.src = qrUrlFor(currentUrl());
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }

      function hideModal() {
        modal.classList.add("hidden");
        document.body.style.overflow = "";
        qrWrap.classList.add("hidden");
        toggleQR.textContent = "Show QR";
      }

      openShare?.addEventListener("click", showModal);
      openShare2?.addEventListener("click", showModal);
      closeShare?.addEventListener("click", hideModal);

      copyBtn?.addEventListener("click", async () => {
        const url = shareUrl.value;
        try {
          await navigator.clipboard.writeText(url);
          alert("Link copied");
        } catch {
          // fallback
          const ta = document.createElement("textarea");
          ta.value = url;
          ta.setAttribute("readonly", "");
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          try {
            document.execCommand("copy");
            alert("Link copied");
          } catch {
            alert("Copy failed");
          }
          document.body.removeChild(ta);
        }
      });

      toggleQR?.addEventListener("click", () => {
        if (qrWrap.classList.contains("hidden")) {
          qrWrap.classList.remove("hidden");
          toggleQR.textContent = "Hide QR";
          qrImg.src = qrUrlFor(currentUrl());
        } else {
          qrWrap.classList.add("hidden");
          toggleQR.textContent = "Show QR";
        }
      });

      downloadQR?.addEventListener("click", async () => {
        try {
          const url = qrUrlFor(currentUrl());
          const resp = await fetch(url);
          const blob = await resp.blob();
          const a = document.createElement("a");
          const obj = URL.createObjectURL(blob);
          a.href = obj;
          a.download = "whisperread-qr.png";
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(obj);
          alert("Downloaded QR");
        } catch (e) {
          alert("Download failed");
        }
      });

      // close modal on outside click
      modal.addEventListener("click", (e) => {
        if (e.target === modal) hideModal();
      });
    </script>
  </body>
</html>
